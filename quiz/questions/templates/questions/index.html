{% extends "questions/base.html" %}
{% load custom_filters %}
{% load i18n %}

{% block content %}
  {% if token %}
  <script type="text/javascript">
    $(function() {
      let url = "ws://" + document.location.host + "/notification/?token={{ token }}"
      let web_socket = new WebSocket(url);

      web_socket.onmessage = function(message) {
        var data = message.data
        if (data == "reload"){
          window.location.reload();
        }
        console.log(message);
      }
    });
  </script>
  {% endif %}
    {% for test in tests %}
      <div class="card w-75">
        <div class="card-body">
          <h4 class="card-title">{{ test.title }}</h4>
          <div class="text-center">
            {% if test.blocked %}
              <a href="" class="btn_test btn btn-dark" style="pointer-events: none; cursor: default; text-decoration: none; color: black; font-size: 18px;">{% trans "НЕ АКТИВЕН" %}</a>
            {% else %}
              <a href="{% url 'test_detail' test.id %}" class="btn_test btn btn-primary">{% trans "К тесту" %}</a>
              <p class="text-muted" style="padding-top: 10px; margin-bottom: -10px;">{% trans "Станет недоступен через" %}: {{ test.deactivate_on|stringformat:".18s" }}</p>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  {% if request.user.is_authenticated and request.user|has_group:"authors" and tests.count == 0 %}
    <div class="card w-75" style="margin-top: 200px;">
      <div class="text-center">
        <h2 class="text-muted">{% trans "Вы еще не создали ни одного теста" %}</h2>
      </div>
    </div>
  {% endif %}

  {% if request.user.is_authenticated and request.user|has_group:"users" and tests.count == 0 %}
    <div class="card w-75" style="margin-top: 200px;">
      <div class="text-center">
        <h2 class="text-muted">{% trans "К сожалению ни одного теста не найдено" %} :( </h2>
      </div>
    </div>
  {% endif %}
{% endblock %}
